{% extends "base.html" %}
{% block title %}Ricerca Comprensori{% endblock %}

{% block content %}
<h2>Trova il tuo comprensorio sciistico</h2>

<div class="search-panel">
    <form method="get" action="/">
        <div class="search-row">
            <label>
                <input
                    type="text"
                    name="name"
                    placeholder="Nome comprensorio"
                    value="{{ request.args.get('name', '') }}"
                />
            </label>

            <label>
                <select name="region">
                    <option value="">Tutte le regioni</option>
                    {% for r in ["Trentino", "Lombardia", "Valle d'Aosta"] %}
                    <option value="{{ r }}"
                        {% if request.args.get("region") == r %}selected{% endif %}
                    >
                        {{ r }}
                    </option>
                    {% endfor %}
                </select>
            </label>
        </div>

        <div class="search-row">
            <label>
                <input
                    type="number"
                    name="min_altitude"
                    placeholder="Altitudine minima (m)"
                    value="{{ request.args.get('min_altitude', '') }}"
                />
            </label>

            <label>
                <input
                    type="number"
                    name="min_slopes"
                    placeholder="Min. numero piste"
                    value="{{ request.args.get('min_slopes', '') }}"
                />
            </label>
        </div>

        <div class="search-row">
            <label>
                <select name="order">
                    <option value="">Ordina per</option>
                    <option value="name">Nome</option>
                    <option value="altitude">Altitudine max</option>
                </select>
            </label>

            <button type="submit">üîç Cerca</button>
        </div>
    </form>
</div>

    <script>
        function searchResorts() {
            const name = document.getElementById("searchName").value;
            const region = document.getElementById("searchRegion").value;

            const params = new URLSearchParams();
            if (name) params.append("name", name);
            if (region) params.append("region", region);

            window.location.href = "/?" + params.toString();
        }
    </script>

<script>
function saveResort(resortId) {
    fetch("/resort/save", {
        method: "POST",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify({resort_id: resortId})
    })
    .then(r => r.json())
    .then(d => {
        if (!d.success) {
            window.location.href = "/login";
        } else {
            alert("Comprensorio salvato!");
        }
    });
}
</script>
{% endblock %}
