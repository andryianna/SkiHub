{% extends "base.html" %}
{% block title %}Ricerca Comprensori{% endblock %}

{% block content %}
<h2>Trova il tuo comprensorio sciistico</h2>

<div class="search-box">
    <label for="searchName"></label><input type="text" id="searchName" placeholder="Nome comprensorio">

    <label for="searchRegion"></label><select id="searchRegion">
        <option value="">Tutte le regioni</option>
        <option value="Trentino">Trentino</option>
        <option value="Lombardia">Lombardia</option>
        <option value="Valle d'Aosta">Valle d'Aosta</option>
    </select>

    <button onclick="searchResorts()">Cerca</button>
</div>

<div class="resort-grid">
    {% for resort in resorts %}
    <div class="resort-card">
        <h3>{{ resort.name }}</h3>

        <p class="location">
            üìç {{ resort.region }} ‚Äì {{ resort.country }}
        </p>

        <p>
            ‚õ∞ Altitudine:
            {{ resort.altitude_min }} m ‚Äì {{ resort.altitude_max }} m
        </p>

        <div class="stats">
            <span>üö° {{ resort.lifts|length }} impianti</span>
            <span>üéø {{ resort.slopes|length }} piste</span>
        </div>

        <a href="/resort/{{ resort.id }}" class="btn">
            Dettagli
        </a>
    </div>
    {% else %}
    <p>Nessun comprensorio trovato.</p>
    {% endfor %}
</div>
    <script>
        function searchResorts() {
            const name = document.getElementById("searchName").value;
            const region = document.getElementById("searchRegion").value;

            const params = new URLSearchParams();
            if (name) params.append("name", name);
            if (region) params.append("region", region);

            window.location.href = "/?" + params.toString();
        }
    </script>

<script>
function saveResort(resortId) {
    fetch("/resort/save", {
        method: "POST",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify({resort_id: resortId})
    })
    .then(r => r.json())
    .then(d => {
        if (!d.success) {
            window.location.href = "/login";
        } else {
            alert("Comprensorio salvato!");
        }
    });
}
</script>
{% endblock %}
